version: v1.0
name: Update Semaphore configuration
agent:
  machine:
    type: e2-standard-2
    os_image: ubuntu2204
blocks:
  - name: C1LoginTest
    task:
      jobs:
        - name: C1LoginTest
          commands:
            - 'version: v1.0'
            - 'name: ChromeDriver Test Automation Pipeline'
            - 'agent:'
            - '  machine:'
            - '    type: e1-standard-2'
            - '    os_image: ubuntu2004'
            - 'blocks:'
            - '  - name: Install Chrome and ChromeDriver'
            - '    task:'
            - '      jobs:'
            - '        - name: Setup Chrome and ChromeDriver'
            - '          commands:'
            - '            - sudo apt-get update'
            - '            - sudo apt-get install -y google-chrome-stable unzip wget'
            - '            - |'
            - '              # Fetch Chrome major version (e.g., 134.0 from 134.0.7000.117)'
            - '              CHROME_VERSION=$(google-chrome --version | grep -oP ''[0-9]+\.[0-9]+\.[0-9]+'' | cut -d ''.'' -f1,2)'
            - '              echo "Chrome Major Version: $CHROME_VERSION"'
            - '              # Fetch matching ChromeDriver version'
            - '              CHROMEDRIVER_VERSION=$(curl -s "https://chromedriver.storage.googleapis.com/LATEST_RELEASE_$CHROME_VERSION")'
            - '              if [ -z "$CHROMEDRIVER_VERSION" ]; then'
            - '                echo "Failed to fetch ChromeDriver version for Chrome $CHROME_VERSION"'
            - '                exit 1'
            - '              fi'
            - '              echo "Matching ChromeDriver Version: $CHROMEDRIVER_VERSION"'
            - '              # Download ChromeDriver'
            - '              wget "https://chromedriver.storage.googleapis.com/$CHROMEDRIVER_VERSION/chromedriver_linux64.zip" -O chromedriver.zip'
            - '              if [ $? -ne 0 ]; then'
            - '                echo "Failed to download ChromeDriver version $CHROMEDRIVER_VERSION"'
            - '                exit 1'
            - '              fi'
            - '              # Unzip ChromeDriver and set permissions'
            - '              unzip chromedriver.zip'
            - '              chmod +x chromedriver'
            - '              sudo mv chromedriver /usr/local/bin/'
            - '              rm chromedriver.zip'
            - '              echo "ChromeDriver $CHROMEDRIVER_VERSION installed successfully."'
            - '  - name: Run Tests'
            - '    task:'
            - '      jobs:'
            - '        - name: Execute Test Automation'
            - '          commands:'
            - '            - echo "Running Tests..."'
            - '            - # Add your test execution command here'
            - 'promotions:'
            - '  - name: Deploy'
            - '    pipeline_file: deploy.yml'
      secrets:
        - name: Cred
